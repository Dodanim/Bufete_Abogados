<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core">

    <body>

        <ui:composition template="./../master_BA.xhtml">
            <ui:define name="barrita">
                <b:form>
                    <b:icon class="ico" value="pause" />
                </b:form>
            </ui:define>
            <ui:define name="titular">
                <p>Mantenimiento</p> 
            </ui:define>
            <ui:define name="subtitular">
                <p>Usuarios</p> 
            </ui:define>

            <ui:define name="content">
             <b:modal id="Ingreso" title="Ingresar Usuario" styleClass="modalPseudoClass">

                    <h:form id="miFormularioI">
                        <h:panelGroup layout="block" styleClass="alert alert-danger"
                                      rendered="#{not empty facesContext.messageList}">
                            <h:messages />
                        </h:panelGroup>
                        <h:panelGrid columns="4" styleClass="table">
                            <h:outputLabel for="IdUsuario" value="Usuario"/>
                            <h:inputText id="carnet" styleClass="form-control"
                                         value="#{usuarioBean.usuario.idUsuario}"
                                         required="true"
                                         requiredMessage="Debes ingresar el IdUsuario"
                                         validatorMessage="formato de id USU000">
                                <f:validateRegex pattern="USU[0-9]{3}"/>
                            </h:inputText>
                            <h:outputLabel for="nombre" value="Nombres:"/>
                            <h:inputText id="nombre" styleClass="form-control"
                                         value="#{usuarioBean.usuario.nombre}"
                                         required="true"
                                         requiredMessage="Debes ingresar el nombre"/>
                            <h:outputLabel for="apellidos" value="Apellidos:"/>
                            <h:inputText id="apellidos" styleClass="form-control"
                                         value="#{usuarioBean.usuario.apellido}"
                                         required="true"
                                         requiredMessage="Debes ingresar el apellido"/>
                            <h:outputLabel for="Password" value="Password:"/>
                            <h:inputSecret id="Password" styleClass="form-control"
                                           value="#{usuarioBean.usuario.password}"
                                           required="true"
                                           requiredMessage="Debes ingresar el Password"/>
                            <h:outputLabel for="IdTipoUsuario" value="IdTipoUsuario:"/>
                            <h:selectOneMenu  value="#{usuarioBean.usuario.idTipoUsuario}"
                                              styleClass="form-control">
                                <f:selectItem itemLabel="Seleccione categoria" itemValue=""/> 
                                <f:selectItems var="lista" value="#{usuarioBean.listaTipos}"
                                               itemLabel="#{lista.tipo}" itemValue="#{lista}"/>
                            </h:selectOneMenu>
                            <h:outputLabel for="estado" value="Estado del usuario:"/>
                            <h:selectOneMenu id="estado" value = "#{usuarioBean.usuario.estado}" 
                                             styleClass="form-control"> 
                                <f:selectItem itemValue = "True" itemLabel = "Activo"  /> 
                                <f:selectItem itemValue = "False" itemLabel = "Deshabilitado" />
                            </h:selectOneMenu>

                        </h:panelGrid>
                        <h:commandButton value="Guardar" styleClass="btn btn-success"
                                         action="#{usuarioBean.guardarRegistro()}" 
                                         style="margin-right:10px"/>
                        <h:commandButton type="reset" value="Limpiar" styleClass="btn btn-danger"/>
                    </h:form>
                </b:modal>
                
                <b:modal id="amodal" title="Modificar Usuario" styleClass="modalPseudoClass">

                    <h:form id="miFormulario">
                        <h:panelGroup layout="block" styleClass="alert alert-danger"
                                      rendered="#{not empty facesContext.messageList}">
                            <h:messages />
                        </h:panelGroup>
                        <h:panelGrid columns="4" styleClass="table">
                            <h:outputLabel for="IdUsuario" value="Usuario"/>
                            <h:inputText id="carnet" styleClass="form-control"
                                         value="#{usuarioBean.usuario.idUsuario}"
                                         required="true"
                                         requiredMessage="Debes ingresar el IdUsuario"
                                         validatorMessage="formato de id USU000">
                                <f:validateRegex pattern="USU[0-9]{3}"/>
                            </h:inputText>
                            <h:outputLabel for="nombre" value="Nombres:"/>
                            <h:inputText id="nombre" styleClass="form-control"
                                         value="#{usuarioBean.usuario.nombre}"
                                         required="true"
                                         requiredMessage="Debes ingresar el nombre"/>
                            <h:outputLabel for="apellidos" value="Apellidos:"/>
                            <h:inputText id="apellidos" styleClass="form-control"
                                         value="#{usuarioBean.usuario.apellido}"
                                         required="true"
                                         requiredMessage="Debes ingresar el apellido"/>
                            <h:outputLabel for="Password" value="Password:"/>
                            <h:inputSecret id="Password" styleClass="form-control"
                                           value="#{usuarioBean.usuario.password}"
                                           required="true"
                                           requiredMessage="Debes ingresar el Password"/>
                            <h:outputLabel for="IdTipoUsuario" value="IdTipoUsuario:"/>
                            <h:selectOneMenu  value="#{usuarioBean.usuario.idTipoUsuario}"
                                              styleClass="form-control">
                                <f:selectItem itemLabel="Seleccione categoria" itemValue=""/> 
                                <f:selectItems var="lista" value="#{usuarioBean.listaTipos}"
                                               itemLabel="#{lista.tipo}" itemValue="#{lista}"/>
                            </h:selectOneMenu>
                            <h:outputLabel for="estado" value="Estado del usuario:"/>
                            <h:selectOneMenu id="estado" value = "#{usuarioBean.usuario.estado}" 
                                             styleClass="form-control"> 
                                <f:selectItem itemValue = "True" itemLabel = "Activo"  /> 
                                <f:selectItem itemValue = "False" itemLabel = "Deshabilitado" />
                            </h:selectOneMenu>

                        </h:panelGrid>
                        <h:commandButton value="Guardar" styleClass="btn btn-success"
                                         action="#{usuarioBean.modificarRegistro()}" 
                                         style="margin-right:10px"/>
                        <h:commandButton type="reset" value="Limpiar" styleClass="btn btn-danger"/>
                    </h:form>
                </b:modal>
                <br/>
                <button id="btrigger" class="btn btn-primary" data-target="#Ingreso" 
                      data-toggle="modal">Agregar Usuario</button>
                    <br/> <br/> 
                <div>
                    
                    <h:form>
                        <b:dataTable value="#{usuarioBean.lista}" class="tablaDatos"
                                     responsive="true"  excel="true" csv="true"
                                     pdf="true" columnVisibility="true" copy="true"
                                     print="true" var="usuario">
                            <b:dataTableColumn label="id Usuario" value="#{usuario.idUsuario}" />

                            <b:dataTableColumn label="Nombres" value="#{usuario.nombre}">
                            </b:dataTableColumn>
                            <b:dataTableColumn label="Apellidos" value="#{usuario.apellido}" />

                            <b:dataTableColumn label="Estado">
                                <h:outputText value="#{usuario.estado?'Activo':'Deshabilitado'}">
                                </h:outputText> 
                            </b:dataTableColumn>
                            <b:dataTableColumn label="">
                                <h:commandButton value="Borrar" styleClass="btn btn-danger"
                                                 action="#{usuarioBean.eliminarRegistro()}">
                                    <f:param name="idUsuario" value="#{usuario.idUsuario}"/>
                                </h:commandButton>
                            </b:dataTableColumn>
                            <b:dataTableColumn label="">
                                <b:commandButton update=":miFormulario"  styleClass="btn btn-info " > 
                                    <a id="atrigger" href="#amodal" data-toggle="modal">Modificar</a>
                                    <f:setPropertyActionListener value="#{usuario}" target="${usuarioBean.usuario}" />
                                </b:commandButton>
                            </b:dataTableColumn>
                        </b:dataTable>
                    </h:form>
                </div>
                     
            </ui:define>

        </ui:composition>

    </body>
</html>
